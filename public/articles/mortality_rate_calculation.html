<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mortality rate calculation • mort.tools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Mortality rate calculation">
<meta property="og:description" content="mort.tools">
<meta property="og:image" content="https://stapm.gitlab.io/r-packages/mort.tools/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-167990045-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-167990045-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mort.tools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/mort-tools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/index.html">Technical documentation</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://gitlab.com/stapm/r-packages/mort.tools">
    <span class="fab fa-gitlab fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://stapm.gitlab.io/software.html">
    <span class="fas fa-code"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="mortality_rate_calculation_files/header-attrs-2.8/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Mortality rate calculation</h1>
            
      
      
      <div class="hidden name"><code>mortality_rate_calculation.Rmd</code></div>

    </div>

    
    
<p>Aim: To calculate the one year central rates of death from diseases defined by specific ICD-10 codes, stratified by specified population subgroups.</p>
<div id="preliminaries" class="section level2">
<h2 class="hasAnchor">
<a href="#preliminaries" class="anchor"></a>Preliminaries</h2>
<ul>
<li>Get access to the data on the <code>heta-study</code> VM.<br>
</li>
<li>Get access to the STAPM Gitlab organisation.<br>
</li>
<li>
<a href="mort-tools.html">Choose a repo</a> as a starting point and get the code on the VM.</li>
</ul>
</div>
<div id="read-the-death-and-population-counts-data" class="section level2">
<h2 class="hasAnchor">
<a href="#read-the-death-and-population-counts-data" class="anchor"></a>Read the death and population counts data</h2>
<p>The functions <code><a href="../reference/ReadPopData.html">mort.tools::ReadPopData()</a></code> and <code><a href="../reference/ReadData.html">mort.tools::ReadData()</a></code> have been written to read the data in the format that it was provided by the data providers and output the data in a nicely formatted form ready for further processing. Depending on the objective for processing, you might then need to filter the data to select only specific geographic regions. You might also need to collapse some of the dimensionality in the data, e.g. if you do not need separate counts of deaths for males and females, then you will need to sum the counts of deaths and population numbers across the sexes.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load the population counts by age, sex, IMD quintile, local authority, year</span>
<span class="va">pop_data</span> <span class="op">&lt;-</span> <span class="fu">mort.tools</span><span class="fu">::</span><span class="fu"><a href="../reference/ReadPopData.html">ReadPopData</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"D:/Death and population data"</span><span class="op">)</span>

<span class="co"># Load the death counts by age, sex, IMD quintile, local authority, year and cause</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">mort.tools</span><span class="fu">::</span><span class="fu"><a href="../reference/ReadData.html">ReadData</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"D:/Death and population data"</span><span class="op">)</span></code></pre></div>
</div>
<div id="grouping-deaths-by-cause" class="section level2">
<h2 class="hasAnchor">
<a href="#grouping-deaths-by-cause" class="anchor"></a>Grouping deaths by cause</h2>
<p>Deaths in the mortality data are assigned a single ICD-10 code e.g. C00, but for our analysis we need to group these into cause-groups according to the groups defined in our lists of tobacco and alcohol related diseases <span class="citation">(<a href="#ref-Angus2018" role="doc-biblioref">Angus et al. 2018</a>; <a href="#ref-webster2018risk" role="doc-biblioref">Webster et al. 2018</a>)</span>. To do this, we create a new column that defines each group by its constituent ICD-10 codes e.g. “C00-C06” becomes the single codes C00, C01, C02, C03, C04, C05, and C06. These are stored in <a href="https://stapm.gitlab.io/r-packages/tobalcepi/reference/tob_icd10_lookups.html">tobalcepi::tob_icd10_lookups</a>, <a href="https://stapm.gitlab.io/r-packages/tobalcepi/reference/alc_icd10_lookups.html">tobalcepi::alc_icd10_lookups</a>, and <a href="https://stapm.gitlab.io/r-packages/tobalcepi/reference/tobalc_icd10_lookups.html">tobalcepi::tobalc_icd10_lookups</a>. We use the function <a href="https://stapm.gitlab.io/r-packages/tobalcepi/reference/ExpandCodes.html">tobalcepi::ExpandCodes()</a> to convert these ICD-10 lookups to ‘long’ form, and use the resulting data table to map the single ICD-10 codes to disease groups. This mapping is done by the function <code><a href="../reference/GroupCauses.html">mort.tools::GroupCauses()</a></code>.</p>
<div id="oesophageal-cancer-scc-ac-splits" class="section level3">
<h3 class="hasAnchor">
<a href="#oesophageal-cancer-scc-ac-splits" class="anchor"></a>Oesophageal cancer SCC-AC splits</h3>
<p>Oesophageal cancer is defined by the ICD-10 code “C15.” It has two subtypes “SCC” and “AC” - these subtypes have different risk relationships to tobacco and alcohol but they are not easy to identify based on the ICD-10 coding system. We therefore use some external data to estimate how total oesophageal cancers might be divided between the subtypes (see our disease list reports <span class="citation">(<a href="#ref-Angus2018" role="doc-biblioref">Angus et al. 2018</a>; <a href="#ref-webster2018risk" role="doc-biblioref">Webster et al. 2018</a>)</span>). The data for splitting is in <code><a href="../reference/oesoph_splits.html">mort.tools::oesoph_splits</a></code> and the function that does the splitting is <code><a href="../reference/SplitOesoph.html">mort.tools::SplitOesoph()</a></code>, which is called by <code><a href="../reference/GroupCauses.html">mort.tools::GroupCauses()</a></code>.</p>
</div>
<div id="zero-deaths" class="section level3">
<h3 class="hasAnchor">
<a href="#zero-deaths" class="anchor"></a>Zero deaths</h3>
<p>There might be some population subgroups for which there have been no deaths from a particular cause, and rows with zero deaths needed to be added in these cases.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Generate the relevant lookup file</span>
<span class="va">lookups</span> <span class="op">&lt;-</span> <span class="fu">tobalcepi</span><span class="fu">::</span><span class="fu"><a href="https://stapm.gitlab.io/r-packages/tobalcepi//reference/ExpandCodes.html">ExpandCodes</a></span><span class="op">(</span><span class="va">tob_icd10_lookups</span><span class="op">)</span>

<span class="co"># Group death data into causes</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">mort.tools</span><span class="fu">::</span><span class="fu"><a href="../reference/GroupCauses.html">GroupCauses</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">lookups</span>, strat_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"imd_quintile"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Where there have been no deaths from a particular cause within a particular subgroup,</span>
<span class="co"># add new rows that have n_deaths = 0</span>
<span class="va">domain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>
  year <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">year</span><span class="op">)</span>,
  age <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">age</span><span class="op">)</span>,
  sex <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span>,
  imd_quintile <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">imd_quintile</span><span class="op">)</span>,
  cause <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">cause</span><span class="op">)</span>
<span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span><span class="op">(</span><span class="va">domain</span><span class="op">)</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span><span class="va">domain</span>, <span class="va">data</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"imd_quintile"</span>, <span class="st">"cause"</span><span class="op">)</span>, all.x <span class="op">=</span> <span class="cn">T</span>, all.y <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">n_deaths</span><span class="op">)</span>, <span class="va">n_deaths</span> <span class="op">:=</span> <span class="fl">0</span><span class="op">]</span></code></pre></div>
</div>
</div>
<div id="calculate-the-central-death-rates" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-the-central-death-rates" class="anchor"></a>Calculate the central death rates</h2>
<p>The cause-specific central death rates can now be calculated for each population subgroup by dividing the annual number of deaths from each cause by the mid-year population size.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Merge the deaths and population counts</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">pop_data</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"imd_quintile"</span><span class="op">)</span>, all <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="co"># Calculate the central death rates</span>
<span class="va">data</span><span class="op">[</span> , <span class="va">mx_cause</span> <span class="op">:=</span> <span class="va">n_deaths</span> <span class="op">/</span> <span class="va">pops</span><span class="op">]</span>

<span class="co"># Check looks ok</span>
<span class="va">data</span><span class="op">[</span> , <span class="fu">.</span><span class="op">(</span>n_deaths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n_deaths</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"cause"</span><span class="op">]</span>

<span class="co"># write data</span>

<span class="co"># note the package version so the data can be tagged with it</span>
<span class="va">ver</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"mort.tools"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"outputs/tob_death_rates_england_national_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"_mort.tools_"</span>, <span class="va">ver</span>, <span class="st">".csv"</span><span class="op">)</span>,
  row.names <span class="op">=</span> <span class="cn">F</span>, sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span></code></pre></div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Angus2018" class="csl-entry">
Angus, Colin, M Henney, L Webster, and Duncan Gillespie. 2018. <em>Alcohol-Attributable Diseases and Dose-Response Curves for the Sheffield Alcohol Policy Model Version 4.0</em>. <a href="https://doi.org/10.15131/shef.data.6819689.v1">https://doi.org/10.15131/shef.data.6819689.v1</a>.
</div>
<div id="ref-webster2018risk" class="csl-entry">
Webster, Laura, Colin Angus, Alan Brennan, and Duncan Gillespie. 2018. <span>“Smoking and the Risks of Adult Diseases.”</span> The University of Sheffield. <a href="https://doi.org/10.15131/shef.data.7411451.v1">https://doi.org/10.15131/shef.data.7411451.v1</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/gillespie_d">Duncan Gillespie</a>, Laura Webster, <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/angus_c">Colin Angus</a>, <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/brennan_a">Alan Brennan</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
