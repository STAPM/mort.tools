<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cause-specific mortality data • mort.tools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Cause-specific mortality data">
<meta property="og:description" content="mort.tools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mort.tools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mort_rates.html">Cause-specific mortality data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Cause-specific mortality data</h1>
            
      
      
      <div class="hidden name"><code>mort_rates.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>This vignette describes how cause-specific mortality data is used in the new Sheffield Tobacco and Alcohol Policy Model (STAPM). STAPM covers a range of applications and is not really a single model, but a collection of code and data that can underlie different modelling approaches and projects. Thus, this code describes the mortality data and code written to process it to facilitate these applications.</p>
<p>To inform the rates of mortality We use Office for National Statistics mortality microdata. These data are used to examine conditions that have been classed as partially attributable to the consumption of tobacco and to put this in the context of deaths from all other causes. We use data from 2001 (being the first year for which estimates by Index of Multiple Deprivation quintile are available) to the latest available. We calculated death rates and later use lifetable methods to estimate the consequent years of life lost to death from each condition.</p>
<div id="death-microdata" class="section level2">
<h2 class="hasAnchor">
<a href="#death-microdata" class="anchor"></a>Death microdata</h2>
<ul>
<li>326 lower tier Local Authorities<br>
</li>
<li>IMD quintiles<br>
</li>
<li>sex<br>
</li>
<li>Age groups single year of age then 100+ (in some years the data was provided with the upper open age-interval of 90+ due to small number counts to avoid being disclosive - so all our analyses use 90+)<br>
</li>
<li>ICD-Codes<br>
</li>
<li>2001-latest available<br>
</li>
<li>Death Counts</li>
</ul>
</div>
<div id="population-microdata" class="section level2">
<h2 class="hasAnchor">
<a href="#population-microdata" class="anchor"></a>Population microdata</h2>
<p>These are mid-year population sizes<br>
- 326 lower tier LAs<br>
- IMD quintiles<br>
- sex<br>
- Age groups single year of age then 100+<br>
- 2001-latest available<br>
- Population Counts</p>
</div>
<div id="information-governance" class="section level2">
<h2 class="hasAnchor">
<a href="#information-governance" class="anchor"></a>Information governance</h2>
<p>The data is stored on and accessed via a University managed secure virtual machine <code>heta_study</code>. This machine is accessible only from the office workstation IP addresses of named individuals via a password protected login.</p>
</div>
<div id="ethics" class="section level2">
<h2 class="hasAnchor">
<a href="#ethics" class="anchor"></a>Ethics</h2>
<p>Ethics approval was received for ‘Investigation of the geographic and socioeconomic variation in alcohol and tobacco related mortality to inform decision support models for policy’ on 25/09/2018 from the School of Health and Related Research at the University of Sheffield with reference number 023092.</p>
</div>
</div>
<div id="cause-specific-death-rates" class="section level1">
<h1 class="hasAnchor">
<a href="#cause-specific-death-rates" class="anchor"></a>Cause-specific death rates</h1>
<p>We first calculate the 1 year cental rates of death for specific ICD code categories for specific population subgroups. To prepare the death rates from tobacco related diseases for England we first aggregate the death counts by age, sex, IMD quintile and year and single ICD-10 codes.</p>
<div id="grouping-deaths-by-cause" class="section level2">
<h2 class="hasAnchor">
<a href="#grouping-deaths-by-cause" class="anchor"></a>Grouping deaths by cause</h2>
<p>Deaths in the mortality data are assigned a single ICD-10 code e.g. C00, but for our analysis we need to group these into cause-groups according to the groups in table 2.1 e.g. C00-C06. To do this, we create a new column that defines each group by its consituent ICD-10 codes e.g. C00, C01, C02, C03, C04, C05, C06. These are stored in <code><a href="../reference/tob_icd10_lookups.html">mort.tools::tob_icd10_lookups</a></code>. We then use the function <code><a href="https://rdrr.io/pkg/tobalcepi/man/ExpandCodes.html">tobalcepi::ExpandCodes()</a></code> to convert these data to ‘long’ form, which we use to map the single ICD-10 codes to disease groups.</p>
<p>We then use the function <code><a href="../reference/GroupCauses.html">mort.tools::GroupCauses()</a></code> to aggregate the cause of death counts by disease group (searching for 3 and 4 character ICD-10 matches).</p>
</div>
<div id="oesphageal-scc-ac-splits" class="section level2">
<h2 class="hasAnchor">
<a href="#oesphageal-scc-ac-splits" class="anchor"></a>Oesphageal SCC-AC splits</h2>
<p>See the <code>tobalcepi</code> package’s vignette for smoking disease risks for an explanation of why and how we split the rates of death from oesophageal cancer into the Squamous cell carcinoma and adenocarcinoma subtypes. The data for splitting is in <code><a href="../reference/oesoph_splits.html">mort.tools::oesoph_splits</a></code> and the function that does the splitting is <code><a href="../reference/SplitOesoph.html">mort.tools::SplitOesoph()</a></code>.</p>
</div>
</div>
<div id="trends-over-time" class="section level1">
<h1 class="hasAnchor">
<a href="#trends-over-time" class="anchor"></a>Trends over time</h1>
<p>To illustrate how to use this code to view the trends over time in the rates of mortality from tobacco related disease, the code below calculates the mortality rates</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r">
<span class="co"># install.packages("//tsclient/X/ScHARR/PR_STAPM/Code/R_packages/mort.tools_1.0.0.zip", </span>
  <span class="co"># repos = NULL, type = "binary")</span>
<span class="co"># install.packages("//tsclient/X/ScHARR/PR_STAPM/Code/R_packages/tobalcepi_0.1.0.zip", </span>
  <span class="co"># repos = NULL)</span>

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">mort.tools</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tobalcepi</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">stringr</span>)

<span class="co"># Prepare the death rates from tobacco related diseases for England</span>

<span class="co"># Load the population counts by age, sex, IMD quintile, local authority, year</span>
<span class="no">pop_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ReadPopData.html">ReadPopData</a></span>(<span class="kw">path</span> <span class="kw">=</span> <span class="st">"D:/Death and population data"</span>)

<span class="co"># Load the death counts by age, sex, IMD quintile, local authority, year and cause</span>
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ReadData.html">ReadData</a></span>(<span class="kw">path</span> <span class="kw">=</span> <span class="st">"D:/Death and population data"</span>)

<span class="co"># Select only England</span>
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="no">data</span>[<span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span>(<span class="no">laua</span>, <span class="fl">1</span>, <span class="fl">1</span>) <span class="kw">==</span> <span class="st">"E"</span>]
<span class="no">pop_data</span> <span class="kw">&lt;-</span> <span class="no">pop_data</span>[<span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span>(<span class="no">laua</span>, <span class="fl">1</span>, <span class="fl">1</span>) <span class="kw">==</span> <span class="st">"E"</span>]

<span class="co"># Collapse local authority splits to national level</span>
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="no">data</span>[ , <span class="fu">.</span>(<span class="kw">n_deaths</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">n_deaths</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="no">T</span>)),
              <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"imd_quintile"</span>, <span class="st">"icd10"</span>)]

<span class="no">pop_data</span> <span class="kw">&lt;-</span> <span class="no">pop_data</span>[ , <span class="fu">.</span>(<span class="kw">pops</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">pops</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="no">T</span>)),
                      <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"imd_quintile"</span>)]

<span class="co"># Generate the relevant lookup file</span>
<span class="no">lookups</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tobalcepi/man/ExpandCodes.html">ExpandCodes</a></span>(<span class="no">tob_icd10_lookups</span>)

<span class="co"># Group death data into causes</span>
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/GroupCauses.html">GroupCauses</a></span>(<span class="no">data</span>, <span class="no">lookups</span>, <span class="kw">strat_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"imd_quintile"</span>))

<span class="co"># Where there have been no deaths from a particular cause within a particular subgroup,</span>
<span class="co"># add new rows that have n_deaths = 0</span>
<span class="no">domain</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span>(
  <span class="kw">year</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">data</span>$<span class="no">year</span>),
  <span class="kw">age</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">data</span>$<span class="no">age</span>),
  <span class="kw">sex</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">data</span>$<span class="no">sex</span>),
  <span class="kw">imd_quintile</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">data</span>$<span class="no">imd_quintile</span>),
  <span class="kw">cause</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">data</span>$<span class="no">cause</span>)
))
<span class="fu">setDT</span>(<span class="no">domain</span>)

<span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span>(<span class="no">domain</span>, <span class="no">data</span>,
              <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"imd_quintile"</span>, <span class="st">"cause"</span>),
              <span class="kw">all.x</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">all.y</span> <span class="kw">=</span> <span class="no">F</span>)

<span class="no">data</span>[<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">n_deaths</span>), <span class="no">n_deaths</span> <span class="kw">:=</span> <span class="fl">0</span>]

<span class="co"># Merge the deaths and population counts</span>
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span>(<span class="no">data</span>, <span class="no">pop_data</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"imd_quintile"</span>), <span class="kw">all</span> <span class="kw">=</span> <span class="no">T</span>)

<span class="co"># Calculate the central death rates</span>
<span class="no">data</span>[ , <span class="no">mx_cause</span> <span class="kw">:=</span> <span class="no">n_deaths</span> / <span class="no">pops</span>]</pre></body></html></div>
<p>To illustrate the trends in the death rates, begin by selecting the rates from one disease (here will choose lung cancer) and calculating the age-standardised death rate, stratified by year, sex and quintiles of the Index of Multiple Deprivation. For the age-standardisation, the package <code>mort.tools</code> contains the 2013 European Standard Population in <code>esp2013</code>, which provides a standard set of weights for calculating average mortality across all ages. Figure 1 shows that lung cancer death rates have been falling for males but rising slightly for females - a trend that warrants further investigation. There are many possible ways of visualising these data, including</p>

<p>The high dimensionality of these data and the number of possible ways to visualise, and their relevance for policymaking, suggests that making an online tool e.g. a Shiny app might be useful (cf. the DH PRP project).</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r">
<span class="co"># Figure 1</span>

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)

<span class="co"># Create age categorys for merging with the European Standard Population</span>
<span class="no">data</span>[, <span class="no">agegroup</span> <span class="kw">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
  <span class="st">"0-4"</span>, <span class="st">"5-9"</span>, <span class="st">"10-14"</span>, <span class="st">"15-19"</span>,  <span class="st">"20-24"</span>, <span class="st">"25-29"</span>, <span class="st">"30-34"</span>, <span class="st">"35-39"</span>, <span class="st">"40-44"</span>,
  <span class="st">"45-49"</span>, <span class="st">"50-54"</span>, <span class="st">"55-59"</span>, <span class="st">"60-64"</span>, <span class="st">"65-69"</span>, <span class="st">"70-74"</span>, <span class="st">"75-79"</span>, <span class="st">"80-84"</span>, <span class="st">"85-89"</span>, <span class="st">"90+"</span>
  )[<span class="fu"><a href="https://rdrr.io/r/base/findInterval.html">findInterval</a></span>(<span class="no">age</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">90</span>, <span class="fl">5</span>))]]

<span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span>(<span class="no">data</span>, <span class="no">esp2013</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"agegroup"</span>)

<span class="co"># Calculate age-standardised mortality rates per 100,000 people for lung cancer </span>
<span class="co"># by year, sex and IMD quintile</span>
<span class="no">lungc_rates</span> <span class="kw">&lt;-</span> <span class="no">data</span>[<span class="no">cause</span> <span class="kw">==</span> <span class="st">"Lung"</span>,
                    <span class="fu">.</span>(<span class="kw">stdrate</span> <span class="kw">=</span> <span class="fl">1e5</span> * <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">mx_cause</span> * <span class="no">ESP2013</span>) / <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">ESP2013</span>)),
                    <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"year"</span>, <span class="st">"sex"</span>, <span class="st">"imd_quintile"</span>)]

<span class="co"># Plot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">lungc_rates</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">year</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">stdrate</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="no">imd_quintile</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~ <span class="no">sex</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Lung cancer"</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"Death rate / 100 thousand people"</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"year"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>()</pre></body></html></div>
<div id="age-patterns" class="section level2">
<h2 class="hasAnchor">
<a href="#age-patterns" class="anchor"></a>Age patterns</h2>
<p>The Sheffield Alcohol Policy Model (SAPM) v4.0 works by updating the rates of mortality observed in the baseline year for the effects of an intervention. The latest year of mortality data that we have currently is 2016. The baseline rates for modelling are therefore the mortality rates by disease, age, sex and IMD quintile observed in 2016.</p>
<p>To stick with lung cancer for illustration, Figure 2 shows the patterns. In STAPM, we use mortality rates in single years of age, whereas STAPM considers mortality rates in age categories. As Figure 2 shows, when dealing with single years of age, due to limited numbers of deaths, there is noise in the age trend (even though there were 28,564 lung cancer deaths in England in 2016). This issue becomes more obvious for causes of death that are rarer e.g. there are several causes with fewer than 5,000 deaths in a year.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r">
<span class="co"># Figure 2</span>

<span class="no">lungc_rates2016</span> <span class="kw">&lt;-</span> <span class="no">data</span>[<span class="no">cause</span> <span class="kw">==</span> <span class="st">"Lung"</span> <span class="kw">&amp;</span> <span class="no">year</span> <span class="kw">==</span> <span class="fl">2016</span>]

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">lungc_rates2016</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">age</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">mx_cause</span> * <span class="fl">1e5</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="no">imd_quintile</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~ <span class="no">sex</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Lung cancer"</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"Death rate / 100 thousand people"</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"age"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>()</pre></body></html></div>
</div>
<div id="smoothed-and-forecast-mortality-rates" class="section level2">
<h2 class="hasAnchor">
<a href="#smoothed-and-forecast-mortality-rates" class="anchor"></a>Smoothed and forecast mortality rates</h2>
<p>STAPM operates on the basis of projecting the past trends in the age-patterns of cause-specific mortality forwards into the future for each sex and Index of Multiple deprivation population subgroup. Intervention effects are then modelled as adjustments to these trends.</p>
<p>The advantages of conducting a cause-specific forecast is that it enables us to incorporate different trends for different diseases and different subgroups e.g. that that there are fewer deaths from Ischeamic Heart disease but more from dementia, and that lung cancer rates are declining in males but rising in females. Cause-specific forecasts stratified by IMD quintiles also allow us to incorporate the different socioeconomic trends in past mortality and to project an expectation of the future socioeconomic trends in mortality.</p>
<p>However, an issue with cause-specific mortality forecasting is that the forecasts of cause-specific mortality rates generally do not add up to the forecasts of the aggregate all-cause mortality rates. Wilmoth <span class="citation">(<a href="#ref-Wilmoth1995">1995</a>)</span> observed that mortality projections are more pessimistic when disaggregated by cause of death because the causes of death that are decreasing the most slowly or that are increasing come to dominate (i.e. the aggegate trends are most influenced by trends in the causes with the most deaths).</p>
<div id="lee-carter-methods" class="section level3">
<h3 class="hasAnchor">
<a href="#lee-carter-methods" class="anchor"></a>Lee-Carter methods</h3>
<p>Our current approach in STAPM is to conduct a Lee-Carter forecast <span class="citation">(Lee and Carter <a href="#ref-Lee1992">1992</a>)</span> separately for mortality from different causes within 10 subgroups defined by combinations of sex and IMD quintile. The Lee-carter method is a “proportional rate of change model”. It summarises the age-period surface of log-mortality rates (<span class="math inline">\(\log{}m_{xt}\)</span>) in terms of vectors <span class="math inline">\(\mathbf{a}\)</span> and <span class="math inline">\(\mathbf{b}\)</span> along the age dimension and <span class="math inline">\(\mathbf{k}\)</span> along the time dimension such that</p>
<p><span class="math display">\[\begin{equation}
\log{}m_{xt}=a_x+b_xk_t+e_{xt}  \label{leecartereq}
\end{equation}\]</span></p>
<p>with restrictions such that the <span class="math inline">\(b\)</span>’s are normalized to sum to one and the <span class="math inline">\(k\)</span>’s sum to zero, so the <span class="math inline">\(a\)</span>’s are average log rates.</p>
<p>The vector <span class="math inline">\(\mathbf{a}\)</span> can be interpreted as an average age profile of mortality, the vector <span class="math inline">\(\mathbf{k}\)</span> tracks mortality changes over time, and the vector <span class="math inline">\(\mathbf{b}\)</span> determines how much each age group changes when <span class="math inline">\(k_t\)</span> changes. When <span class="math inline">\(k_t\)</span> is linear on time each age group changes at its own exponential rate, but this is not a requirement of the model. The error term reflects age-period effects not captured by the model.</p>
<p>The vector <span class="math inline">\(\mathbf{a}\)</span> is estimated by averaging log rates over time and <span class="math inline">\(\mathbf{b}\)</span> and <span class="math inline">\(\mathbf{k}\)</span> via a singular value decomposition (SVD) of the residuals (this is essentially a method for approximating a matrix as the product of two vectors).</p>
<p>Having reduced the time dimension of mortality to a single vector <span class="math inline">\(\mathbf{k}\)</span>, this is then projected forward by an ARIMA time series model. In our forecasting for STAPM we don’t currently incorporate forecast error but if we were to then it would be based on the error in this time series model.</p>
<p>Future mortality is then estimated by inputting the extrapolated values of <span class="math inline">\(k_t\)</span> back into ().</p>
</div>
<div id="our-application-of-these-methods" class="section level3">
<h3 class="hasAnchor">
<a href="#our-application-of-these-methods" class="anchor"></a>Our application of these methods</h3>
<p>Before we conduct our cause and subgroup specific mortality forecast, we reduce the noise in the matrix of observed rates of mortality by smoothing each matrix over age and period. To do so, we estimate a moving average based on the application of a two-dimensional sliding window (we adjust the degree of smoothing by adjusting the size of the window). We find that smoothing is particularly important for the rarer causes, as the projected future trends for these causes can be strongly influenced by noise in the observed rates.</p>
<p>We conduct the forecast using the R package <code>demography</code> <span class="citation">(Rob J Hyndman with contributions from Heather Booth and Leonie Tickle and John Maindonald., <a href="#ref-RJHHBLTJ2019">n.d.</a>)</span>. We conduct a set of cause-specific forecasts and also a forecast of the remaining other-cause mortality. In our <code>mort.tools</code> R package, the forecast is conducted by the function <code><a href="../reference/CombinedForecast.html">CombinedForecast()</a></code>, which is a wrapper that calls the function <code><a href="../reference/MortalityForecast.html">MortalityForecast()</a></code> to run the forecast for each cause and groups the outputs together. The forecast is run for 10 population subgroups defined by combinations of sex and IMD quintile.</p>
<p>The parameters that control the forecast for each cause are contained in a separate spreadsheet, which is input into <code><a href="../reference/CombinedForecast.html">CombinedForecast()</a></code> as <code>forecast_params</code> (Figure 3). The parameters in this spreadsheet allow the control of the period and and age range that are used to inform the forecast for each cause, and the degree of smoothing to apply to the past trends in mortality.</p>
<p><img src="forecast_spreadsheet_snapshot.png"></p>
<p>Given all the potential unreliabilities of a cause-specific forecast, it is important to consider how far in the future the trends in mortality might be extrapolated reliably. Once this final year is determined, if we want the STAPM projections to run beyond it, we assume that the mortality rates in the control arm of our model will remain constant into the future from this final year.</p>
<p>There is lots of room for improvement in this forecasting method, particularly looking into incorporating forecast undertainty, and developing methods that improve the consistency between the forecasts of cause-specific mortality and those of all-cause mortality <span class="citation">(Li et al. <a href="#ref-Li2019">2019</a>; Arnold and Sherris <a href="#ref-Arnold2013">2013</a>; Bergeron-Boucher et al. <a href="#ref-Bergeron-Boucher2017">2017</a>)</span>.</p>
</div>
<div id="example-forecast" class="section level3">
<h3 class="hasAnchor">
<a href="#example-forecast" class="anchor"></a>Example forecast</h3>
<p>The following code provides the observed and forecast cause and subgroup specific mortality rates for use in STAPM. In this case, we forecast the trends from 2016 to 2100. In Figure 4, we select the forecast values for lung cancer in males and compare the forecast trends between the least and most deprived IMD quintiles.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r">
<span class="co">#install.packages("X:/ScHARR/PR_STAPM/Code/R_packages/mort.tools_1.0.0.zip", </span>
  <span class="co"># repos = NULL, type = "binary")</span>

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">mort.tools</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">readxl</span>)

<span class="co"># The observed mortality rates to input into the smoothing and forecasting process</span>
<span class="no">mort_data_cause</span> <span class="kw">&lt;-</span> <span class="fu">fread</span>(<span class="st">"X:/ScHARR/PR_Mortality_data_TA/Code/model_inputs/Output/
                         tob_death_rates_national_2019-05-06_mort.tools_1.0.0.csv"</span>)

<span class="co"># The paramaters that control the smoothing and forecast methods for each cause</span>
<span class="no">params</span> <span class="kw">&lt;-</span> <span class="fu">setDT</span>(<span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_xlsx</a></span>(<span class="st">"data-raw/Mortality data/
                          tobacco mortality forecasting parameters.xlsx"</span>))

<span class="co"># Run the forecast</span>
<span class="no">cforecast</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/CombinedForecast.html">CombinedForecast</a></span>(
  <span class="kw">data</span> <span class="kw">=</span> <span class="no">mort_data_cause</span>,
  <span class="kw">forecast_params</span> <span class="kw">=</span> <span class="no">params</span>,
  <span class="kw">n_years</span> <span class="kw">=</span> <span class="fl">2100</span> - <span class="fl">2016</span>, <span class="co"># time horizon - jumpoff year</span>
  <span class="kw">folder_path</span> <span class="kw">=</span> <span class="st">"data-raw/Mortality data"</span>
)

<span class="no">tob_mort_data_cause</span> <span class="kw">&lt;-</span> <span class="fu">copy</span>(<span class="no">cforecast</span>$<span class="no">mx_data_cause</span>)</pre></body></html></div>
</div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Arnold2013">
<p>Arnold, Séverine, and Michael Sherris. 2013. “Forecasting Mortality Trends Allowing for Cause-of-Death Mortality Dependence.” Journal Article. <em>North American Actuarial Journal</em> 17 (4): 273–82. <a href="https://doi.org/10.1080/10920277.2013.838141">https://doi.org/10.1080/10920277.2013.838141</a>.</p>
</div>
<div id="ref-Bergeron-Boucher2017">
<p>Bergeron-Boucher, Marie-Pier, Vladimir Canudas-Romo, Jim Oeppen, and James W. Vaupel. 2017. “Coherent Forecasts of Mortality with Compositional Data Analysis.” Journal Article. <em>Demographic Research</em> 37: 527–66. <a href="https://doi.org/10.4054/DemRes.2017.37.17">https://doi.org/10.4054/DemRes.2017.37.17</a>.</p>
</div>
<div id="ref-Lee1992">
<p>Lee, Ronald D, and Lawrence R Carter. 1992. “Modeling and Forecasting Us Mortality.” Journal Article. <em>Journal of the American Statistical Association</em> 87 (419): 659–71.</p>
</div>
<div id="ref-Li2019">
<p>Li, Han, Hong Li, Yang Lu, and Anastasios Panagiotelis. 2019. “A Forecast Reconciliation Approach to Cause-of-Death Mortality Modeling.” Journal Article. <em>Insurance: Mathematics and Economics</em> 86: 122–33. <a href="https://doi.org/10.1016/j.insmatheco.2019.02.011">https://doi.org/10.1016/j.insmatheco.2019.02.011</a>.</p>
</div>
<div id="ref-RJHHBLTJ2019">
<p>Rob J Hyndman with contributions from Heather Booth and Leonie Tickle and John Maindonald. n.d. <em>demography: Forecasting Mortality, Fertility, Migration and Population Data</em>. <a href="%7Bhttps://CRAN.R-project.org/package=demography%7D">{https://CRAN.R-project.org/package=demography}</a>.</p>
</div>
<div id="ref-Wilmoth1995">
<p>Wilmoth, J. R. 1995. “Are Mortality Projections Always More Pessimistic When Disaggregated by Cause of Death?” Journal Article. <em>Math Popul Stud</em> 5 (4): 293–319, 377. <a href="https://doi.org/10.1080/08898489509525409">https://doi.org/10.1080/08898489509525409</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/gillespie_d">Duncan Gillespie</a>, Laura Webster, <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/angus_c">Colin Angus</a>, <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/brennan_a">Alan Brennan</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
